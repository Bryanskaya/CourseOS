\section{Конструкторская часть}

\subsection{Требования к программе}
Межсетевой экран должен быть реализован в виде загружаемого модуля, и предоставлять следующие возможности:
\begin{itemize}
	\item добавление нового правила;

	\item удаление правила;
	
	\item просмотр всех правил;
	
	\item сокрытие модуля в системе;
	
	\item обнаружение модуля в системе. \\
\end{itemize}

Для непосредственного взаимодействия с пользователем необходимо разработать отдельную программу, представляющую из себя интерфейс для работы с загружаемым модулем. Программа выполняет не только функцию связующего звена между пользователем и межсетевым экраном, но и проверку входных данных: корректность вводимых команд и правил. \\

\subsection{Инициализация модуля}
На Рисунке \ref{fig3:image} представлена подробная схема алгоритма инициализации модуля.
\begin{figure}[p]
	\begin{center}
		{\includegraphics[scale = 0.6]{img/init.pdf}}
		\caption{Схема инициализации модуля}
		\label{fig3:image}
	\end{center}
\end{figure}

\newpage

\subsection{Завершение работы модуля}
При выгрузке необходимо освободить все ресурсы, которые были зарезервированы в процессе работы модуля. 

Детально работа этой функции изложена на Рисунке \ref{fig4:image}.
\begin{figure}[h!]
	\begin{center}
		{\includegraphics[scale = 0.6]{img/exit.pdf}}
		\caption{Схема выгрузки модуля}
		\label{fig4:image}
	\end{center}
\end{figure}

\newpage

\subsection{Основные функции, определяемые в struct file\_operations}
При инициализации модуля одним из первых действий является заполнение структуры \textbf{struct file\_operations}, в которой определяются функции для работы с файлами. В рамках поставленной задачи необходимо указать свои функции read (для того, чтобы получить список всех правил), write (используется для обработки нового правила). 

На Рисунках \ref{fig5:image} -- \ref{fig6:image} приведены схемы для функций чтения и записи.
\begin{figure}[h!]
	\begin{center}
		{\includegraphics[scale = 0.6]{img/read.pdf}}
		\caption{Схема работы функции чтения}
		\label{fig5:image}
	\end{center}
\end{figure}

\begin{figure}[h!]
	\begin{center}
		{\includegraphics[scale = 0.6]{img/write.pdf}}
		\caption{Схема работы функции записи}
		\label{fig6:image}
	\end{center}
\end{figure}

\newpage

\subsection{Функции добавления и удаления правил}
Пользователю предоставляется возможность добавить новое правило или удалить уже существующее. На Рисунках \ref{fig7:image} и \ref{fig8:image} показан общий подход к реализации каждой из них.

\begin{figure}[h!]
	\begin{center}
		{\includegraphics[scale = 0.6]{img/add_rule.pdf}}
		\caption{Схема работы функции добавления нового правила}
		\label{fig7:image}
	\end{center}
\end{figure}

\begin{figure}[h!]
	\begin{center}
		{\includegraphics[scale = 0.7]{img/del_rule.png}}
		\caption{Схема работы функции удаления правила}
		\label{fig8:image}
	\end{center}
\end{figure}

\pagebreak

\subsection{Функция фильтрации пакетов}
В процессе инициализации модуля также происходит регистрация хук-функций, заданных в структуре \textbf{struct nf\_hook\_ops} и необходимых для работы межсетевого экрана. 

В рамках поставленной задачи регистрируются две функции: для обработки входящих и исходящих пакетов. Поскольку главное их отличие -- направление анализируемых единиц, то рекомендуется реализовать одну функцию, в которую подаётся соответствующий список правил. Детали работы этой функции представлены на Рисунках \ref{fig9:image} -- \ref{fig10:image}.

\begin{figure}[h!]
	\begin{center}
		{\includegraphics[scale = 0.55]{img/filter1.pdf}}
		\caption{Схема работы функции фильтрации пакетов}
		\label{fig9:image}
	\end{center}
\end{figure}

\begin{figure}[h!]
	\begin{center}
		{\includegraphics[scale = 0.75]{img/filter2.png}}
		\caption{Схема работы функции фильтрации пакетов (продолжение)}
		\label{fig10:image}
	\end{center}
\end{figure}

\subsection{Выводы}
В разделе рассмотрены требования к программе, основные сведения о модуле, предоставлены схемы, описывающие ключевые моменты в его работе.
